webpackJsonp([40],{gDP6:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});l("NYxO");var a=l("Wxq9"),s={data:function(){return{allStaff:[],staff:"",query_show:!1,currentPage:1,pagesize:20,marketingClueAdd:{},marketingClueAddLabel:[],tableData:[],selectValue:[],customers:[],customer:"",contacts_rules:{field_must_company_name:[{required:!0,message:"请选择客户",trigger:"change"}],field_must_name:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}]},savaflag:"",xsly:[],gjzt:[],jhly:[],jhlx:[],yxjd:[],dsQuery:{name:"",type:"",cus_name:"",state:"",classify:"",recent_follow_time:[]},marketing_clue_rules:{},options:a.regionData,dialogAddVisible:!1,dialogTransferVisible:!1}},mounted:function(){var e=this;this.$post("/crm/getDict",{list:["crm-xsly","crm-kh-gjzt"]},function(t){e.xsly=t["crm-xsly"],e.gjzt=t["crm-kh-gjzt"]})},activated:function(){this.initTableData()},methods:{initTableData:function(){var e=this;this.$post("/crm/marketingCluePR/queryMarketingClue",this.dsQuery,function(t){e.tableData=t.list,console.log(e.tableData)})},handleCurrentChange:function(e){this.currentPage=e},closeAdd:function(){this.$refs.marketingClueAdd.resetFields()},add_marketing_clue:function(){var e=this;this.$post("/crm/extFieldPR/getField",{tableName:"crm_marketing_clue"},function(t){e.marketingClueAddLabel=t.list,t.list.map(function(t){"date"!=t.fieldType&&"cascade"==t.fieldType&!t.value&&(e.marketingClueAdd[t.name]=[]),e.marketing_clue_rules[t.name]={required:!0,message:"请输入"+t.label,trigger:"text"==t.fieldType?"blur":"change"}}),e.dialogAddVisible=!0})},openModal:function(){var e=this;this.customers.length||this.$post("/crm/queryAllCustomers",{},function(t){e.customers=t.customers})},marketingClueSave:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.marketingClueAdd.customerId=t.marketingClueAdd.customerName.split("/")[1],t.marketingClueAdd.customerName=t.marketingClueAdd.customerName.split("/")[0],t.$post("/crm/marketingCluePR/addMarketingClue",t.marketingClueAdd,function(e){t.$notify.success({message:"操作成功！"}),t.initTableData(),t.dialogAddVisible=!1}))})},delete_marketing_clue:function(){var e=this;this.selectValue.length<1?this.$notify.warning({message:"请勾选数据！"}):this._confirm("确定删除吗?",function(){var t=[];e.selectValue.map(function(e){t.push(e.field_must_id)}),e.$post("/crm/marketingCluePR/deleteCrmMarketingClue",{list:t},function(t){t.message?e.$message.error(t.message):e.$message.success("删除成功！"),e.$refs.table.clearSelection(),e.initTableData()})})},turnOther:function(){var e=this;this.selectValue.length<1?this.$message.error("请勾选数据！"):(this.allStaff.length||this.$post("/crm/getAllStaff",{},function(t){e.allStaff=t.list}),this.dialogTransferVisible=!0)},turn_other_sava:function(){var e=this;if(this.staff){var t=[];this.selectValue.map(function(e){t.push(e.field_must_id)});var l={list:t,ownerId:this.staff};this.$post("/crm/marketingCluePR/turnOther",l,function(t){e.dialogTransferVisible=!1,e.$message.success("转移成功！"),e.getCustomers(),e.$refs.table.clearSelection()})}else this.$message.error("请选择新拥有者！")},submit:function(){console.log(this.formQuery)},handleSelectionChange:function(e){this.selectValue=e}}},r={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"wrap"},[l("el-form",{staticClass:"query-form",attrs:{"label-position":"left",size:"small",inline:!0,model:e.dsQuery,"label-width":"70px"}},[l("el-form-item",{attrs:{label:"线索名称"}},[l("el-input",{attrs:{clearable:"",placeholder:""},model:{value:e.dsQuery.name,callback:function(t){e.$set(e.dsQuery,"name",t)},expression:"dsQuery.name"}})],1),e._v(" "),l("el-form-item",[l("el-button",{attrs:{type:"primary"},on:{click:e.initTableData}},[e._v("查询")])],1),e._v(" "),l("el-form-item",[e._v("\n                "),l("a",{staticClass:"text-base",on:{click:function(t){e.query_show=!e.query_show}}},[e._v("更多查询条件"),l("i",{class:"el-icon--right el-icon-arrow-down iconfont icon-"+e.query_show})])]),e._v(" "),l("div",{directives:[{name:"show",rawName:"v-show",value:e.query_show,expression:"query_show"}]},[l("div",{staticClass:"input-box"},[l("el-form-item",{attrs:{label:"线索来源"}},[l("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dsQuery.type,callback:function(t){e.$set(e.dsQuery,"type",t)},expression:"dsQuery.type"}},e._l(e.xsly,function(e){return l("el-option",{key:e,attrs:{label:e,value:e}})}))],1),e._v(" "),l("el-form-item",{attrs:{label:"客户名称"}},[l("el-input",{attrs:{clearable:"",placeholder:""},model:{value:e.dsQuery.cus_name,callback:function(t){e.$set(e.dsQuery,"cus_name",t)},expression:"dsQuery.cus_name"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"跟进状态"}},[l("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dsQuery.state,callback:function(t){e.$set(e.dsQuery,"state",t)},expression:"dsQuery.state"}},e._l(e.gjzt,function(e){return l("el-option",{key:e,attrs:{label:e,value:e}})}))],1)],1),e._v(" "),l("div",{staticClass:"input-box"},[l("el-form-item",{attrs:{label:"分类"}},[l("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.dsQuery.classify,callback:function(t){e.$set(e.dsQuery,"classify",t)},expression:"dsQuery.classify"}},[l("el-option",{attrs:{value:"0",label:"全部"}}),e._v(" "),l("el-option",{attrs:{value:"1",label:"我拥有的"}}),e._v(" "),l("el-option",{attrs:{value:"2",label:"我参与的"}})],1)],1),e._v(" "),l("el-form-item",{attrs:{label:"跟进时间"}},[l("el-date-picker",{staticStyle:{width:"250px","margin-right":"30px"},attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd","default-time":["00:00:00","23:59:59"]},model:{value:e.dsQuery.recent_follow_time,callback:function(t){e.$set(e.dsQuery,"recent_follow_time",t)},expression:"dsQuery.recent_follow_time"}})],1)],1)])],1),e._v(" "),l("el-row",[l("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.add_marketing_clue()}}},[e._v("新增")]),e._v(" "),l("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.delete_marketing_clue()}}},[e._v("删除")]),e._v(" "),l("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.turnOther}},[e._v("转给他人")])],1),e._v(" "),l("el-table",{ref:"table",staticClass:"table",staticStyle:{width:"100%",margin:"20px 0"},attrs:{data:e.tableData.slice((e.currentPage-1)*e.pagesize,e.currentPage*e.pagesize),"max-height":"500",border:"","header-cell-class-name":"text-center","cell-class-name":"text-center","default-sort":{prop:"",order:"descending"}},on:{"selection-change":e.handleSelectionChange}},[l("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),l("el-table-column",{attrs:{prop:"name",label:"线索名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("router-link",{attrs:{to:"./marketing_clue_detail?id="+t.row.id}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"customerName",sortable:"",label:"客户名称"}}),e._v(" "),l("el-table-column",{attrs:{prop:"clueSource",sortable:"",label:"线索来源"}}),e._v(" "),l("el-table-column",{attrs:{prop:"mobilePhone",label:"联系方式"}}),e._v(" "),l("el-table-column",{attrs:{prop:"ownerCname",label:"拥有者"}}),e._v(" "),l("el-table-column",{attrs:{prop:"lastFollowTime",label:"最近跟进时间"}}),e._v(" "),l("el-table-column",{attrs:{prop:"followStatus",label:"跟进状态"}}),e._v(" "),l("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.createTime.split(" ")[0])+"\n            ")]}}])})],1),e._v(" "),l("el-pagination",{staticStyle:{float:"right"},attrs:{background:"",layout:"total,prev, pager, next","page-size":e.pagesize,"current-page":e.currentPage,total:e.tableData.length},on:{"current-change":e.handleCurrentChange}}),e._v(" "),l("el-dialog",{staticClass:"dialogAdd",attrs:{title:"新增线索",width:"600px",visible:e.dialogAddVisible,"close-on-click-modal":!1},on:{close:e.closeAdd,"update:visible":function(t){e.dialogAddVisible=t},open:e.openModal}},[l("el-form",{ref:"marketingClueAdd",attrs:{model:e.marketingClueAdd,"label-position":"left","label-width":"120px",size:"small"}},[l("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[l("el-select",{attrs:{size:"small",filterable:"",clearable:"",placeholder:"请输入客户名称"},model:{value:e.marketingClueAdd.customerName,callback:function(t){e.$set(e.marketingClueAdd,"customerName",t)},expression:"marketingClueAdd.customerName"}},e._l(e.customers,function(e){return l("el-option",{key:e.id,attrs:{label:e.name,value:e.name+"/"+e.id}})}))],1),e._v(" "),e._l(e.marketingClueAddLabel,function(t,a){return l("el-form-item",{key:a,attrs:{label:t.label,prop:t.name}},["text"==t.editorType?l("el-input",{model:{value:e.marketingClueAdd[t.name],callback:function(l){e.$set(e.marketingClueAdd,t.name,l)},expression:"marketingClueAdd[item.name]"}}):e._e(),e._v(" "),"date"==t.editorType?l("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm",type:"datetime",placeholder:"选择日期时间"},model:{value:e.marketingClueAdd[t.name],callback:function(l){e.$set(e.marketingClueAdd,t.name,l)},expression:"marketingClueAdd[item.name]"}}):e._e(),e._v(" "),"dict"==t.editorType?l("el-select",{model:{value:e.marketingClueAdd[t.name],callback:function(l){e.$set(e.marketingClueAdd,t.name,l)},expression:"marketingClueAdd[item.name]"}},e._l(t.selectList,function(a){return"dict"==t.editorType?l("el-option",{key:a,attrs:{label:a,value:a}}):e._e()})):e._e(),e._v(" "),"cascade"==t.editorType?l("el-cascader",{attrs:{size:"small",options:e.cityData()},model:{value:e.marketingClueAdd[t.name],callback:function(l){e.$set(e.marketingClueAdd,t.name,l)},expression:"marketingClueAdd[item.name]"}}):e._e()],1)})],2),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.dialogAddVisible=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:function(t){e.marketingClueSave("marketingClueAdd")}}},[e._v("确 定")])],1)],1),e._v(" "),l("el-dialog",{attrs:{title:"转给他人",width:"40%",visible:e.dialogTransferVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogTransferVisible=t}}},[l("el-form",{ref:"form",attrs:{"label-width":"120px",size:"small"}},[l("el-form-item",{attrs:{label:"新拥有者"}},[l("el-form-item",[l("el-select",{attrs:{size:"small",filterable:"",clearable:"",placeholder:"请输入员工姓名或工号"},model:{value:e.staff,callback:function(t){e.staff=t},expression:"staff"}},e._l(e.allStaff,function(t){return l("el-option",{key:t.userName,attrs:{label:t.cname+"  "+t.userName,value:t.userName}},[l("span",{staticStyle:{float:"left"}},[e._v(e._s(t.cname))]),e._v(" "),l("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.userName))])])}))],1)],1)],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.dialogTransferVisible=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:e.turn_other_sava}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var i=l("VU/8")(s,r,!1,function(e){l("vJfp")},"data-v-074f85f6",null);t.default=i.exports},vJfp:function(e,t){}});
//# sourceMappingURL=40.cc0b1435ee7865e09927.js.map