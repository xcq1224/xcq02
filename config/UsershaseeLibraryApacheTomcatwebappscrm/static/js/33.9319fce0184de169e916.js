webpackJsonp([33],{er8G:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),n=a.n(s),l=(a("NYxO"),{data:function(){return{customers:[],customer:"",imgSrc:"",dynamicTags:[],inputVisible:!1,inputValue:"",contactsAddLabel:[],contactsAdd:{},contacts_rules:{customerName:[{required:!0,message:"请选择客户",trigger:"change"}],name:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],mobilePhone:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,a){/^1[0-9]{10}$/.test(t)?a():a(new Error("手机号错误!"))},trigger:"blur"}]},dsQuery:{},query_show:!1,contacts:[],dialogAddVisible:!1,savaflag:"",selectValue:[],currentPage:1,pagesize:20}},activated:function(){this.getContacts()},methods:{getContacts:function(){var e=this;console.log(this.selectedOptions),this.$post("/crm/contactsPR/queryCrmContacts",this.dsQuery,function(t){e.contacts=t.list})},addcontats:function(){var e=this;this.$post("/crm/extFieldPR/getField",{tableName:"crm_contacts"},function(t){e.contactsAddLabel=t.list,t.list.map(function(t){"cascade"==t.editorType&!t.value&&(e.contactsAdd[t.name]=[])}),e.dialogAddVisible=!0})},openModal:function(){var e=this;this.customers.length||this.$post("/crm/queryAllCustomers",{},function(t){e.customers=t.customers})},closeModal:function(){this.dynamicTags=[],this.imgSrc="",this.$refs.uploadInput.value="",this.$refs.form.resetFields()},chooseImg:function(){this.$refs.uploadInput.click()},pictureChange:function(e){e.target.files.length&&(this.imgSrc=e.target.files[0])},handleClose:function(e){this.dynamicTags.splice(this.dynamicTags.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&this.dynamicTags.push(e),this.inputVisible=!1,this.inputValue=""},contactsSave:function(){var e=this;this.$refs.form.validate(function(t){if(t){e.contactsAdd.customerId=e.contactsAdd.customerName.split("/")[1],e.contactsAdd.customerName=e.contactsAdd.customerName.split("/")[0],e.contactsAdd.tags=e.dynamicTags;var a=new FormData;a.append("avatar",e.imgSrc),a.append("contactsAdd",n()(e.contactsAdd)),e.$post("/crm/contactsPR/addCrmContacts",a,function(t){e.$notify.success({message:"操作成功！"}),e.getContacts(),e.dialogAddVisible=!1})}})},deleteCrmContacts:function(){var e=this;this.selectValue.length<1?this.$notify.warning({message:"请勾选数据！"}):this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[];e.selectValue.map(function(e){t.push(e.id)}),e.$post("/crm/contactsPR/deleteCrmContacts",{list:t},function(t){e.$message.success("操作成功！"),e.getContacts()})})},handleSelectionChange:function(e){this.selectValue=e},handleCurrentChange:function(e){this.currentPage=e}}}),o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrap"},[a("el-form",{staticClass:"query-form",attrs:{"label-position":"left",size:"small",inline:!0,model:e.dsQuery,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{clearable:"",placeholder:""},model:{value:e.dsQuery.name,callback:function(t){e.$set(e.dsQuery,"name",t)},expression:"dsQuery.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.getContacts()}}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[e._v("\n          "),a("a",{staticClass:"text-base",on:{click:function(t){e.query_show=!e.query_show}}},[e._v("更多查询条件"),a("i",{class:"iconfont icon-"+e.query_show})])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.query_show,expression:"query_show"}]},[a("div",{staticClass:"input-box"},[a("el-form-item",{attrs:{label:"客户名称"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:e.dsQuery.customerName,callback:function(t){e.$set(e.dsQuery,"customerName",t)},expression:"dsQuery.customerName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{attrs:{placeholder:"",clearable:""},model:{value:e.dsQuery.mobilePhone,callback:function(t){e.$set(e.dsQuery,"mobilePhone",t)},expression:"dsQuery.mobilePhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{staticStyle:{width:"250px","margin-right":"30px"},attrs:{type:"daterange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd","default-time":["00:00:00","23:59:59"]},model:{value:e.dsQuery.createTime,callback:function(t){e.$set(e.dsQuery,"createTime",t)},expression:"dsQuery.createTime"}})],1)],1)])],1),e._v(" "),a("el-row",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.addcontats()}}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.deleteCrmContacts()}}},[e._v("删除")])],1),e._v(" "),a("el-table",{staticClass:"table",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.contacts.slice((e.currentPage-1)*e.pagesize,e.currentPage*e.pagesize),"max-height":"500",border:"","default-sort":{prop:"name",order:"filed_must_creatTime"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"姓名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{staticClass:"text-base",attrs:{to:"./contacts_detail?id="+t.row.id}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"customerName",label:"客户名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"job",label:"职务"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dept",label:"部门"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobilePhone",label:"手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"business",label:"负债业务"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.createTime.split(" ")[0])+"\n      ")]}}])})],1),e._v(" "),a("br"),e._v(" "),a("el-pagination",{staticStyle:{float:"right"},attrs:{background:"",layout:"total,prev, pager, next","page-size":e.pagesize,"current-page":e.currentPage,total:e.contacts.length},on:{"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{staticClass:"dialogAdd",attrs:{title:"新增联系人",width:"600px",visible:e.dialogAddVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogAddVisible=t},open:e.openModal,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{model:e.contactsAdd,rules:e.contacts_rules,"label-position":"left","label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"照片"}},[a("div",{staticClass:"upload-box",on:{click:e.chooseImg}},[a("i",{directives:[{name:"show",rawName:"v-show",value:!e.imgSrc,expression:"!imgSrc"}],staticClass:"el-icon-plus"}),e._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:e.imgSrc,expression:"imgSrc"}],attrs:{src:e.getUrl(e.imgSrc),alt:""}}),e._v(" "),a("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploadInput",attrs:{type:"file",accept:"image/*"},on:{change:e.pictureChange}})])]),e._v(" "),a("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[a("el-select",{attrs:{size:"small",filterable:"",clearable:"",placeholder:"请输入客户名称"},model:{value:e.contactsAdd.customerName,callback:function(t){e.$set(e.contactsAdd,"customerName",t)},expression:"contactsAdd.customerName"}},e._l(e.customers,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.name+"/"+e.id}})}))],1),e._v(" "),e._l(e.contactsAddLabel,function(t,s){return a("el-form-item",{key:s,attrs:{prop:t.name,label:t.label}},["text"==t.editorType?a("el-input",{model:{value:e.contactsAdd[t.name],callback:function(a){e.$set(e.contactsAdd,t.name,a)},expression:"contactsAdd[item.name]"}}):e._e(),e._v(" "),"date"==t.editorType?a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.contactsAdd[t.name],callback:function(a){e.$set(e.contactsAdd,t.name,a)},expression:"contactsAdd[item.name]"}}):e._e(),e._v(" "),"dict"==t.editorType?a("el-select",{model:{value:e.contactsAdd[t.name],callback:function(a){e.$set(e.contactsAdd,t.name,a)},expression:"contactsAdd[item.name]"}},e._l(t.selectList,function(s){return"dict"==t.editorType?a("el-option",{key:s,attrs:{label:s,value:s}}):e._e()})):e._e()],1)}),e._v(" "),a("el-form-item",{attrs:{label:"标签"}},[e._l(e.dynamicTags,function(t){return a("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){e.handleClose(t)}}},[e._v("\n          "+e._s(t)+"\n        ")])}),e._v(" "),e.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.handleInputConfirm(t):null}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ New Tag")])],2)],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogAddVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.contactsSave()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var i=a("VU/8")(l,o,!1,function(e){a("exbD")},"data-v-41f94e58",null);t.default=i.exports},exbD:function(e,t){}});
//# sourceMappingURL=33.9319fce0184de169e916.js.map