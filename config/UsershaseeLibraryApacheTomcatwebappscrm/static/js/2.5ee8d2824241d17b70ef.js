webpackJsonp([2],{"1miA":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=(a("NYxO"),a("Wxq9")),l={data:function(){return{query:{},contact:{},isEdit:!1,imgSrc:"",inputVisible:!1,inputValue:"",contactsAddLabel:[],contactsAdd:{},otherContacts:[],relationShipList:[],relation:"",relationList:["叔叔","哥哥","姐姐"],relationship:{tags:[]},relationImgSrc:"",hideList:["business","dept","job","customerName"],relationInputVisible:!1,relationInputValue:"",activeName:"first",dynamicTags:[],is_show:!0,options:n.regionData,selectedOptions:[],tableData1:[],tableData2:[],tableData3:[{name:123,address:123}],tableData4:[],dialogRelateInfoVisible:!1,dialogChanceVisible:!1,dialogTransferVisible:!1,editVisible:!1,dialogFolowVisible:!1,chanceForm:{},transferForm:{},tagVisible:!1,tagValue:"",isEditRelationShip:!1}},activated:function(){this.query=this.$router.currentRoute.query,this.getContact()},methods:{getContact:function(){var t=this;this.$post("/crm/contactsDetailPR/queryContactsForOne",{id:this.query.id},function(e){t.contact=e.contact,t.contactsAdd=t.deepClone(e.contact)}),this.$post("/crm/extFieldPR/getField",{tableName:"crm_contacts"},function(e){t.contactsAddLabel=e.list})},chooseImg:function(){this.$refs.uploadInput.click()},pictureChange:function(t){t.target.files.length&&(this.imgSrc=t.target.files[0])},deleteTag:function(t){this.contactsAdd.tags.splice(this.contactsAdd.tags.indexOf(t),1)},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(e){t.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.inputValue;t&&this.contactsAdd.tags.push(t),this.inputVisible=!1,this.inputValue=""},editCustomer:function(){this.activeName="first",this.isEdit=!0},cancelEdit:function(){this.isEdit=!1,this.contactsAdd=this.deepClone(this.contact)},customerSave:function(){var t=this,e=new FormData;e.append("contact_str",s()(this.contactsAdd)),this.$post("/crm/contactsPR/updateContact",e,function(e){t.$message.success("修改成功！"),t.isEdit=!1,t.contact=t.deepClone(t.contactsAdd)})},getOtherContacts:function(){var t=this;this.$post("/crm/contactsDetailPR/queryOtherContacts",{id:this.contact.customerId},function(e){t.otherContacts=[],e.list.map(function(e){e.id!=t.contact.id&&t.otherContacts.push(e)})})},chooseRelationImg:function(){this.$refs.relationInput.click()},relationImgChange:function(t){t.target.files.length&&(this.relationImgSrc=t.target.files[0])},relationDeleteTag:function(t){this.relationship.tags.splice(this.relationship.tags.indexOf(t),1)},relationShowInput:function(){var t=this;this.relationInputVisible=!0,this.$nextTick(function(e){t.$refs.relationSaveTagInput.$refs.input.focus()})},relationHandleInputConfirm:function(){var t=this.relationInputValue;t&&this.relationship.tags.push(t),this.relationInputVisible=!1,this.relationInputValue=""},relationShipAdd:function(){var t=this;if(this.isEditRelationShip){var e=new FormData;e.append("relation",this.relation),e.append("relationShipId",this.relationship.relationShipId),delete this.relationship.relation,delete this.relationship.relationShipId,e.append("contact_str",s()(this.relationship)),this.$post("/crm/contactsPR/updateContact",e,function(e){t.$notify.success({message:"操作成功！"}),t.dialogRelateInfoVisible=!1,t.getContactRelation()})}else{var a=new FormData;a.append("avatar",this.relationImgSrc),a.append("id",this.contact.id),a.append("relation",this.relation),a.append("relationship",s()(this.relationship)),this.$post("/crm/contactsDetailPR/addContactRelation",a,function(e){t.$notify.success({message:"操作成功！"}),t.dialogRelateInfoVisible=!1,t.getContactRelation()})}},closeRelationModal:function(){this.relationship={tags:[]},this.relation="",this.relationImgSrc="",this.relationship.tags=[],this.$refs.relationInput.value="",this.isEditRelationShip=!1},getContactRelation:function(){var t=this;this.$post("/crm/contactsDetailPR/queryContactRelation",{id:this.contact.id},function(e){t.relationShipList=e.list})},delContactRelation:function(t,e,a){var i=this;this._confirm("确定删除吗?",function(){var s={id:e,bId:i.contact.id,relationShipId:a};i.$post("/crm/contactsDetailPR/delContactRelation",s,function(e){i.$message.success("删除成功"),i.relationShipList.splice(t,1)})})},editContactRelation:function(t){this.isEditRelationShip=!0,this.dialogRelateInfoVisible=!0,this.relationship=this.deepClone(this.relationShipList[t]),this.relation=this.relationship.relation},delContact:function(){var t=this;this._confirm("确定删除吗?",function(){t.$post("/crm/contactsPR/deleteCrmContacts",{list:[t.contact.id]},function(e){t.$message.success("删除成功！"),t.$router.back(-1)})})}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrap contact-detail"},[a("div",{staticClass:"header"},[a("div",{staticClass:"header-top"},[a("span",{staticClass:"header-name"},[t._v(t._s(t.contact.name))]),t._v(" "),a("span",[t._v("  客户名称："),a("router-link",{staticClass:"text-base",attrs:{to:"./client_detail?id="+t.contact.customerId}},[t._v(t._s(t.contact.customerName))])],1)]),t._v(" "),a("el-row",[a("el-button",{attrs:{type:"primary",size:"mini"},nativeOn:{click:function(e){return t.goBack(e)}}},[t._v("返回")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.dialogRelateInfoVisible=!0}}},[t._v("添加关联信息")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.editCustomer}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.delContact}},[t._v("删除")])],1)],1),t._v(" "),a("div",{staticClass:"main"},[a("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"first"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},slot:"label"},[t._v("基本信息")]),t._v(" "),a("div",{staticClass:"first"},[a("p",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticStyle:{"margin-bottom":"20px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.customerSave}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.cancelEdit}},[t._v("取消")])],1),t._v(" "),a("el-form",{ref:"contactsAdd",staticClass:"form",attrs:{model:t.contactsAdd,inline:!0,"label-position":"left","label-width":"120px",size:"small"}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"照片"}},[a("div",{staticClass:"upload-box",class:t.isEdit?"":"active",on:{click:t.chooseImg}},[a("i",{directives:[{name:"show",rawName:"v-show",value:!t.imgSrc,expression:"!imgSrc"}],staticClass:"el-icon-plus"}),t._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:t.imgSrc,expression:"imgSrc"}],attrs:{src:t.getUrl(t.imgSrc),alt:""}}),t._v(" "),a("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploadInput",attrs:{type:"file",disabled:!t.isEdit,accept:"image/*"},on:{change:t.pictureChange}})])]),a("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.contactsAdd.customerName,callback:function(e){t.$set(t.contactsAdd,"customerName",e)},expression:"contactsAdd.customerName"}})],1),t._l(t.contactsAddLabel,function(e,i){return a("el-form-item",{key:i,attrs:{prop:e.name,label:e.label}},["text"==e.editorType?a("el-input",{attrs:{disabled:!t.isEdit||"name"==e.name},model:{value:t.contactsAdd[e.name],callback:function(a){t.$set(t.contactsAdd,e.name,a)},expression:"contactsAdd[item.name]"}}):t._e(),t._v(" "),"date"==e.editorType?a("el-date-picker",{attrs:{disabled:!t.isEdit,"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:t.contactsAdd[e.name],callback:function(a){t.$set(t.contactsAdd,e.name,a)},expression:"contactsAdd[item.name]"}}):t._e(),t._v(" "),"dict"==e.editorType?a("el-select",{attrs:{disabled:!t.isEdit},model:{value:t.contactsAdd[e.name],callback:function(a){t.$set(t.contactsAdd,e.name,a)},expression:"contactsAdd[item.name]"}},t._l(e.selectList,function(i){return"dict"==e.editorType?a("el-option",{key:i,attrs:{label:i,value:i}}):t._e()})):t._e()],1)}),a("el-form-item",{attrs:{label:"标签"}},[t._l(t.contactsAdd.tags,function(e){return a("el-tag",{key:e,attrs:{closable:t.isEdit,"disable-transitions":!1},on:{close:function(a){t.deleteTag(e)}}},[t._v("\n                                "+t._s(e)+"\n                            ")])}),t._v(" "),t.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleInputConfirm(e):null}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ New Tag")])],2)],2)],1)]),t._v(" "),a("el-tab-pane",{attrs:{name:"second"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},on:{click:t.getOtherContacts},slot:"label"},[t._v("公司其他联系人")]),t._v(" "),a("div",{staticClass:"second"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.otherContacts,"max-height":"500",border:"","row-style":{"text-align":"center",color:"#333"},"header-cell-style":{"text-align":"center",background:"#f2f2f2","border-color":"#fff",color:"#333"}}},[a("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"mobilePhone",label:"手机"}}),t._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"电话"}}),t._v(" "),a("el-table-column",{attrs:{prop:"job",label:"职务"}}),t._v(" "),a("el-table-column",{attrs:{prop:"mail",label:"邮箱"}})],1)],1)]),t._v(" "),a("el-tab-pane",{attrs:{name:"third"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},on:{click:t.getContactRelation},slot:"label"},[t._v("相关联系人")]),t._v(" "),a("div",{staticClass:"third"},[a("div",{staticClass:"box-card-list"},t._l(t.relationShipList,function(e,i){return a("el-card",{key:i,staticClass:"box-card"},[a("div",[a("span",{staticClass:"del",on:{click:function(a){t.delContactRelation(i,e.id,e.relationShipId)}}},[t._v("×")]),t._v(" "),a("span",{staticClass:"edit",on:{click:function(e){t.editContactRelation(i)}}},[t._v("编辑")]),t._v(" "),a("p",{staticClass:"tip"},[t._v("与联系人关系： "+t._s(e.relation))]),t._v(" "),t._l(t.contactsAddLabel,function(i,s){return-1==t.hideList.indexOf(i.name)?a("p",{key:s},[a("span",{staticClass:"label"},[t._v(t._s(i.label)+"：")]),a("span",{staticClass:"content"},[t._v(t._s(e[i.name]))])]):t._e()}),t._v(" "),a("p",[a("span",{staticClass:"label"},[t._v("标签：")]),t._v(" "),a("font",{staticClass:"content"},t._l(e.tags,function(e){return a("el-tag",{key:e,attrs:{"disable-transitions":!1}},[t._v("\n                                            "+t._s(e)+"\n                                        ")])}))],1)],2)])}))])]),t._v(" "),a("el-tab-pane",{attrs:{name:"fourth"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},slot:"label"},[t._v("机会")]),t._v(" "),a("div",{staticClass:"fourth"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData1,"max-height":"500",border:"","row-style":{"text-align":"center",color:"#333"},"header-cell-style":{"text-align":"center",background:"#f2f2f2","border-color":"#fff",color:"#333"}}},[a("el-table-column",{attrs:{prop:"date",label:"机会名称",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"预计营销金额",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"营销阶段"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"赢单率"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"备注"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"创建时间"}})],1)],1)]),t._v(" "),a("el-tab-pane",{attrs:{name:"fifth"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},slot:"label"},[t._v("操作日志")]),t._v(" "),a("div",{staticClass:"fifth"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData4,"max-height":"500",border:"","row-style":{"text-align":"center",color:"#333"},"header-cell-style":{"text-align":"center",background:"#f2f2f2","border-color":"#fff",color:"#333"}}},[a("el-table-column",{attrs:{prop:"date",label:"操作时间",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"操作人",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address",label:"备注"}})],1)],1)])],1)],1),t._v(" "),a("el-dialog",{staticClass:"form",attrs:{title:"添加关联信息",visible:t.dialogRelateInfoVisible,"close-on-click-modal":!1,width:"550px"},on:{"update:visible":function(e){t.dialogRelateInfoVisible=e},close:t.closeRelationModal}},[a("el-form",{ref:"relationship",attrs:{model:t.relationship,"label-position":"left","label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"照片"}},[a("div",{staticClass:"upload-box",on:{click:t.chooseRelationImg}},[a("i",{directives:[{name:"show",rawName:"v-show",value:!t.relationImgSrc,expression:"!relationImgSrc"}],staticClass:"el-icon-plus"}),t._v(" "),a("img",{directives:[{name:"show",rawName:"v-show",value:t.relationImgSrc,expression:"relationImgSrc"}],attrs:{src:t.getUrl(t.relationImgSrc),alt:""}}),t._v(" "),a("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"relationInput",attrs:{type:"file",accept:"image/*"},on:{change:t.relationImgChange}})])]),t._v(" "),a("el-form-item",{attrs:{label:"与联系人关系"}},[a("el-select",{model:{value:t.relation,callback:function(e){t.relation=e},expression:"relation"}},t._l(t.relationList,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}))],1),t._v(" "),t._l(t.contactsAddLabel,function(e,i){return-1==t.hideList.indexOf(e.name)?a("el-form-item",{key:i,attrs:{prop:e.name,label:e.label}},["text"==e.editorType?a("el-input",{attrs:{disabled:"name"==e.name&&t.isEditRelationShip},model:{value:t.relationship[e.name],callback:function(a){t.$set(t.relationship,e.name,a)},expression:"relationship[item.name]"}}):t._e(),t._v(" "),"date"==e.editorType?a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:t.relationship[e.name],callback:function(a){t.$set(t.relationship,e.name,a)},expression:"relationship[item.name]"}}):t._e(),t._v(" "),"dict"==e.editorType?a("el-select",{model:{value:t.relationship[e.name],callback:function(a){t.$set(t.relationship,e.name,a)},expression:"relationship[item.name]"}},t._l(e.selectList,function(i){return"dict"==e.editorType?a("el-option",{key:i,attrs:{label:i,value:i}}):t._e()})):t._e()],1):t._e()}),t._v(" "),a("el-form-item",{attrs:{label:"标签"}},[t._l(t.relationship.tags,function(e){return a("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){t.relationDeleteTag(e)}}},[t._v("\n                    "+t._s(e)+"\n                ")])}),t._v(" "),t.relationInputVisible?a("el-input",{ref:"relationSaveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.relationHandleInputConfirm},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.relationHandleInputConfirm(e):null}},model:{value:t.relationInputValue,callback:function(e){t.relationInputValue=e},expression:"relationInputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.relationShowInput}},[t._v("+ New Tag")])],2)],2),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogRelateInfoVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.relationShipAdd}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var r=a("VU/8")(l,o,!1,function(t){a("JnrO"),a("BgHU")},"data-v-0f0625a7",null);e.default=r.exports},BgHU:function(t,e){},JnrO:function(t,e){}});
//# sourceMappingURL=2.5ee8d2824241d17b70ef.js.map