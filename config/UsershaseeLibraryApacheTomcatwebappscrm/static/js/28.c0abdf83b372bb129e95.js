webpackJsonp([28],{"9Vsp":function(e,t){},Hufc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Wxq9"),s={data:function(){return{query:{},activeName:"first",basicInfo:{},addLabel:[],isEdit:!1,tableData:[],options:i.regionData,dialogAnnexVisible:!1,annexList:[],files:[],annexRemarks:""}},activated:function(){this.query=this.$router.currentRoute.query,this.getBaseInfo()},methods:{getBaseInfo:function(){var e=this;this.$post("/crm/competitorDetailPR/queryCompetitorForOne",{id:this.query.id},function(t){e.basicInfo=t.basicInfo}),this.addLabel.length||this.$post("/crm/extFieldPR/getField",{tableName:"crm_competitor"},function(t){e.addLabel=t.list})},edit:function(){this.activeName="first",this.isEdit=!0},cancelEdit:function(){this.isEdit=!1,this.$refs.form.resetFields()},editSave:function(){var e=this;this.$post("/crm/competitorPR/modifyOne",this.basicInfo,function(t){e.$message.success("修改成功！"),e.isEdit=!1})},del:function(){var e=this;this._confirm("确定删除吗?",function(){e.$post("/crm/competitorPR/delete",{list:[e.basicInfo.id]},function(t){e.$message.success("删除成功！"),e.$router.back(-1)})})},getAttachs:function(){var e=this;this.$post("/crm/getAttachs",{parentId:this.basicInfo.id},function(t){e.annexList=t.list})},delAnnex:function(e,t){var a=this;this._confirm("确定删除吗?",function(){a.$post("/crm/deleteFile",{ids:[e]},function(e){a.$message.success("删除成功"),a.annexList.splice(t,1)})})},downLoadAnnex:function(e){console.log("下载")},closeAnnexModal:function(){this.annexRemarks="",this.files=[]},chooseAnnex:function(){this.$refs.annexInput.click()},changeFile:function(e){for(var t=this.$refs.annexInput.files,a=0;a<t.length;a++)this.files.push(t[a]);this.$refs.annexInput.value=""},delFile:function(e){this.files.splice(e,1)},annexSave:function(){var e=this;if(this.files.length){var t=new FormData;this.files.map(function(e,a){t.append("file"+a,e)}),t.append("remark",this.annexRemarks),t.append("parentId",this.basicInfo.id),this.$post("/crm/upfile2",t,function(t){e.$message.success("上传成功！"),e.dialogAnnexVisible=!1,e.getAttachs()})}else this.$message.error("请选择上传文件！")}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrap"},[a("div",{staticClass:"handle-box"},[a("div",{staticClass:"header-top"},[a("span",{staticClass:"header-name"},[e._v(e._s(e.basicInfo.name))])]),e._v(" "),a("el-row",[a("el-button",{attrs:{type:"primary",size:"mini"},nativeOn:{click:function(t){return e.goBack(t)}}},[e._v("返回")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.edit}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.del}},[e._v("删除")])],1)],1),e._v(" "),a("div",{staticStyle:{height:"20px",background:"#fafafa"}}),e._v(" "),a("div",{staticClass:"main"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"first"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},slot:"label"},[e._v("基本信息")]),e._v(" "),a("div",{staticClass:"first"},[a("p",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticStyle:{"margin-bottom":"20px"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.editSave}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:e.cancelEdit}},[e._v("取消")])],1),e._v(" "),a("el-form",{ref:"form",staticClass:"form",attrs:{inline:!0,model:e.basicInfo,"label-position":"left","label-width":"120px",size:"small"}},e._l(e.addLabel,function(t,i){return a("el-form-item",{key:i,attrs:{label:t.label,prop:t.name}},["text"==t.editorType?a("el-input",{attrs:{type:"textarea",resize:"none",autosize:"",disabled:!e.isEdit||"name"==t.name,prop:t.name},model:{value:e.basicInfo[t.name],callback:function(a){e.$set(e.basicInfo,t.name,a)},expression:"basicInfo[item.name]"}}):e._e(),e._v(" "),"date"==t.editorType?a("el-date-picker",{attrs:{disabled:!e.isEdit,"value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm",type:"datetime",placeholder:"选择日期时间"},model:{value:e.basicInfo[t.name],callback:function(a){e.$set(e.basicInfo,t.name,a)},expression:"basicInfo[item.name]"}}):e._e(),e._v(" "),"dict"==t.editorType?a("el-select",{attrs:{disabled:!e.isEdit},model:{value:e.basicInfo[t.name],callback:function(a){e.$set(e.basicInfo,t.name,a)},expression:"basicInfo[item.name]"}},e._l(t.selectList,function(i){return"dict"==t.editorType?a("el-option",{key:i,attrs:{label:i,value:i}}):e._e()})):e._e(),e._v(" "),"cascade"==t.editorType?a("el-cascader",{attrs:{disabled:!e.isEdit,size:"small",options:e.cityData()},model:{value:e.basicInfo[t.name],callback:function(a){e.$set(e.basicInfo,t.name,a)},expression:"basicInfo[item.name]"}}):e._e()],1)}))],1)]),e._v(" "),a("el-tab-pane",{attrs:{name:"second"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},slot:"label"},[e._v("机会")]),e._v(" "),a("div",{staticClass:"second"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"max-height":"500",border:"","row-style":{"text-align":"center",color:"#333"},"header-cell-style":{"text-align":"center",background:"#f2f2f2","border-color":"#fff",color:"#333"}}},[a("el-table-column",{attrs:{prop:"date",label:"机会名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"预计营销金额"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"营销阶段"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"赢单率"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"创建时间"}})],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{name:"third"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},on:{click:e.getAttachs},slot:"label"},[e._v("附件")]),e._v(" "),a("div",{staticClass:"third"},[a("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogAnnexVisible=!0}}},[e._v("上传附件")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.annexList,"max-height":"500",border:"","row-style":{"text-align":"center",color:"#333"},"header-cell-style":{"text-align":"center",background:"#f2f2f2","border-color":"#fff",color:"#333"}}},[a("el-table-column",{attrs:{prop:"fileName",label:"附件名称",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"fileSizeStr",label:"大小",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"备注"}}),e._v(" "),a("el-table-column",{attrs:{prop:"upUserCname",label:"上传人"}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(e.formatDate(new Date(t.row.upTime),"yyyy-MM-dd hh:mm:ss"))+"\n                            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"operating",on:{click:function(a){e.downLoadAnnex(t.row.id)}}},[e._v("下载")]),e._v(" "),a("a",{staticClass:"operating",on:{click:function(a){e.delAnnex(t.row.id,t.$index)}}},[e._v("删除")])]}}])})],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{name:"fourth"}},[a("span",{staticClass:"tab-item",attrs:{slot:"label"},slot:"label"},[e._v("操作日志")]),e._v(" "),a("div",{staticClass:"fourth"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"max-height":"500",border:"","row-style":{"text-align":"center",color:"#333"},"header-cell-style":{"text-align":"center",background:"#f2f2f2","border-color":"#fff",color:"#333"}}},[a("el-table-column",{attrs:{prop:"date",label:"操作时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"操作人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"备注"}})],1)],1)])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传附件",visible:e.dialogAnnexVisible,"close-on-click-modal":!1,width:"550px"},on:{"update:visible":function(t){e.dialogAnnexVisible=t},close:e.closeAnnexModal}},[a("el-form",{attrs:{labelPosition:"left","label-width":"60px"}},[a("el-form-item",{attrs:{label:"附件："}},[a("div",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.chooseAnnex}},[e._v("选择文件")]),a("span",{staticStyle:{color:"#409EFF","margin-left":"10px"}},[e._v("单个文件最大支持100MB，上传请耐心等待")]),e._v(" "),e._l(e.files,function(t,i){return a("p",{key:i,staticStyle:{"line-height":"24px"}},[e._v(e._s(t.name)+"\n                        "),a("a",{staticStyle:{float:"right",color:"#409EFF"},on:{click:function(t){e.delFile(i)}}},[e._v("删除")])])})],2),e._v(" "),a("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"annexInput",attrs:{type:"file",multiple:""},on:{change:e.changeFile}})]),e._v(" "),a("el-form-item",{attrs:{label:"备注："}},[a("el-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:2},maxlength:"200",placeholder:"请填写备注(200字以内)"},model:{value:e.annexRemarks,callback:function(t){e.annexRemarks=t},expression:"annexRemarks"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogAnnexVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.annexSave}},[e._v("保存")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(s,l,!1,function(e){a("9Vsp")},"data-v-59e757b5",null);t.default=n.exports}});
//# sourceMappingURL=28.c0abdf83b372bb129e95.js.map